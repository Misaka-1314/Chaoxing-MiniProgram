import{_ as n,c as a,d as e,o as l}from"./app-DCcFVubk.js";const p="/image/guide/EO%E5%8A%A0%E9%80%9F.png",o={};function r(c,s){return l(),a("div",null,[...s[0]||(s[0]=[e('<h1 id="反向代理服务端部署教程" tabindex="-1"><a class="header-anchor" href="#反向代理服务端部署教程"><span>反向代理服务端部署教程</span></a></h1><blockquote><p>微信小程序配置服务器域名 要求域名已备案</p><p>自用无需备案，体验版开启调试模式即可</p></blockquote><h2 id="使用-cdn-或边缘函数反代" tabindex="-1"><a class="header-anchor" href="#使用-cdn-或边缘函数反代"><span>使用 CDN 或边缘函数反代</span></a></h2><h3 id="使用-cloudflare-worker" tabindex="-1"><a class="header-anchor" href="#使用-cloudflare-worker"><span>使用 Cloudflare Worker</span></a></h3><p>把下面的反向代理脚本粘贴到 Workers 编辑器中。</p><blockquote><p>注意：Worker默认的域名已被墙，请自备域名；已知部分沿海城市阻断了CF的IP。</p></blockquote><p><a href="https://deploy.workers.cloudflare.com/?url=https://github.com/Misaka-1314/Chaoxing-MiniProgram/tree/main/server/cloudflare" target="_blank" rel="noopener noreferrer"><img src="https://deploy.workers.cloudflare.com/button" alt="使用 Cloudflare Workers 部署" loading="lazy"></a></p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>请修改根目录为 <code>server/cloudflare</code>。<br> 如果部署有问题，请自行复制代码粘贴到 Cloudflare Workers！<a href="https://github.com/Misaka-1314/Chaoxing-MiniProgram/blob/main/server/cloudflare/_worker.js" target="_blank" rel="noopener noreferrer">去复制代码</a></p></div><h3 id="使用腾讯云-edgeone-边缘函数" tabindex="-1"><a class="header-anchor" href="#使用腾讯云-edgeone-边缘函数"><span>使用腾讯云 EdgeOne 边缘函数</span></a></h3><p><a href="https://edgeone.ai/pages/new?repository-url=https%3a%2f%2fgithub.com%2fMisaka-1314%2fChaoxing-MiniProgram%2ftree%2fmain%2fserver%2fedgeone&amp;project-name=cx-proxy&amp;repository-name=cx-proxy" target="_blank" rel="noopener noreferrer"><img src="https://cdnstatic.tencentcs.com/edgeone/pages/deploy.svg" alt="使用 腾讯云 EdgeOne 边缘函数部署" loading="lazy"></a></p><h3 id="使用腾讯云-edgeone-站点加速" tabindex="-1"><a class="header-anchor" href="#使用腾讯云-edgeone-站点加速"><span>使用腾讯云 EdgeOne 站点加速</span></a></h3><img src="'+p+`" style="width:min(60vw, 480px);"><h2 id="自建反代服务器" tabindex="-1"><a class="header-anchor" href="#自建反代服务器"><span>自建反代服务器</span></a></h2><h3 id="caddy-配置文件示例" tabindex="-1"><a class="header-anchor" href="#caddy-配置文件示例"><span>Caddy 配置文件示例</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="background-color:#ffffff;color:#393a34;"><pre class="shiki vitesse-light vp-code"><code class="language-"><span class="line"><span>example.com {</span></span>
<span class="line"><span>    handle_path /proxy/* {</span></span>
<span class="line"><span>        reverse_proxy &quot;https://mobilelearn.chaoxing.com&quot; {</span></span>
<span class="line"><span>            header_up Host &quot;mobilelearn.chaoxing.com&quot;</span></span>
<span class="line"><span>            header_up Referer &quot;https://mobilelearn.chaoxing.com&quot;</span></span>
<span class="line"><span>            header_up Origin &quot;https://mobilelearn.chaoxing.com&quot;</span></span>
<span class="line"><span>            header_up User-Agent &quot;Mozilla/5.0 (iPhone Mac OS X) github.com/misaka-1314&quot;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span> reverse_proxy http://127.0.0.1:8080</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="background-color:#ffffff;color:#393a34;"><pre class="shiki vitesse-light vp-code"><code class="language-"><span class="line"><span>http://192.168.x.x:8080 {</span></span>
<span class="line"><span>    handle_path /proxy/* {</span></span>
<span class="line"><span>        reverse_proxy &quot;https://mobilelearn.chaoxing.com&quot; {</span></span>
<span class="line"><span>            header_up Host &quot;mobilelearn.chaoxing.com&quot;</span></span>
<span class="line"><span>            header_up Referer &quot;https://mobilelearn.chaoxing.com&quot;</span></span>
<span class="line"><span>            header_up Origin &quot;https://mobilelearn.chaoxing.com&quot;</span></span>
<span class="line"><span>            header_up User-Agent &quot;Mozilla/5.0 (iPhone Mac OS X) github.com/misaka-1314&quot;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span> reverse_proxy http://127.0.0.1:8080</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nginx-配置文件示例" tabindex="-1"><a class="header-anchor" href="#nginx-配置文件示例"><span>Nginx 配置文件示例</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="background-color:#ffffff;color:#393a34;"><pre class="shiki vitesse-light vp-code"><code class="language-nginx"><span class="line"><span style="color:#AB5959;">server</span><span style="color:#393A34;"> {</span></span>
<span class="line"><span style="color:#1E754F;">    listen </span><span style="color:#2F798A;">443</span><span style="color:#393A34;"> ssl</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">    server_name </span><span style="color:#393A34;">example.com</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">    ssl_certificate </span><span style="color:#393A34;">/path/to/your/certificate.crt</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">    ssl_certificate_key </span><span style="color:#393A34;">/path/to/your/private.key</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">    location</span><span style="color:#59873A;"> /proxy/ </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#1E754F;">        rewrite</span><span style="color:#AB5E3F;"> ^/proxy/(.*)$</span><span style="color:#393A34;"> /</span><span style="color:#999999;">$</span><span style="color:#B07D48;">1</span><span style="color:#1E754F;"> break</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">        proxy_pass </span><span style="color:#393A34;">https://mobilelearn.chaoxing.com</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_set_header </span><span style="color:#393A34;">Host </span><span style="color:#B56959;">&quot;mobilelearn.chaoxing.com&quot;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_set_header </span><span style="color:#393A34;">Referer </span><span style="color:#B56959;">&quot;https://mobilelearn.chaoxing.com&quot;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_set_header </span><span style="color:#393A34;">Origin </span><span style="color:#B56959;">&quot;https://mobilelearn.chaoxing.com&quot;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_set_header </span><span style="color:#393A34;">User-Agent </span><span style="color:#B56959;">&quot;Mozilla/5.0 (iPhone Mac OS X) github.com/misaka-1314&quot;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">    location</span><span style="color:#59873A;"> / </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_pass </span><span style="color:#393A34;">http://127.0.0.1:8080</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    }</span></span>
<span class="line"><span style="color:#393A34;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="background-color:#ffffff;color:#393a34;"><pre class="shiki vitesse-light vp-code"><code class="language-nginx"><span class="line"><span style="color:#AB5959;">server</span><span style="color:#393A34;"> {</span></span>
<span class="line"><span style="color:#1E754F;">    listen </span><span style="color:#2F798A;">8080</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">    server_name </span><span style="color:#393A34;">192.168.x.x</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">    location</span><span style="color:#59873A;"> /proxy/ </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#1E754F;">        rewrite</span><span style="color:#AB5E3F;"> ^/proxy/(.*)$</span><span style="color:#393A34;"> /</span><span style="color:#999999;">$</span><span style="color:#B07D48;">1</span><span style="color:#1E754F;"> break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span></span>
<span class="line"><span style="color:#1E754F;">        proxy_pass </span><span style="color:#393A34;">https://mobilelearn.chaoxing.com</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_set_header </span><span style="color:#393A34;">Host </span><span style="color:#B56959;">&quot;mobilelearn.chaoxing.com&quot;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_set_header </span><span style="color:#393A34;">Referer </span><span style="color:#B56959;">&quot;https://mobilelearn.chaoxing.com&quot;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_set_header </span><span style="color:#393A34;">Origin </span><span style="color:#B56959;">&quot;https://mobilelearn.chaoxing.com&quot;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_set_header </span><span style="color:#393A34;">User-Agent </span><span style="color:#B56959;">&quot;Mozilla/5.0 (iPhone Mac OS X) github.com/misaka-1314&quot;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">    location</span><span style="color:#59873A;"> / </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#1E754F;">        proxy_pass </span><span style="color:#393A34;">http://127.0.0.1:8080</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    }</span></span>
<span class="line"><span style="color:#393A34;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用-python-反代" tabindex="-1"><a class="header-anchor" href="#使用-python-反代"><span>使用 Python 反代</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#ffffff;color:#393a34;"><pre class="shiki vitesse-light vp-code"><code class="language-python"><span class="line"><span style="color:#1E754F;">from</span><span style="color:#393A34;"> fastapi </span><span style="color:#1E754F;">import</span><span style="color:#393A34;"> FastAPI</span><span style="color:#999999;">,</span><span style="color:#393A34;"> Request</span><span style="color:#999999;">,</span><span style="color:#393A34;"> Response</span></span>
<span class="line"><span style="color:#1E754F;">from</span><span style="color:#393A34;"> urllib</span><span style="color:#999999;">.</span><span style="color:#393A34;">parse </span><span style="color:#1E754F;">import</span><span style="color:#393A34;"> urljoin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">app </span><span style="color:#999999;">=</span><span style="color:#393A34;"> FastAPI</span><span style="color:#999999;">(</span><span style="color:#B07D48;">redoc_url</span><span style="color:#999999;">=</span><span style="color:#1E754F;">None</span><span style="color:#999999;">,</span><span style="color:#B07D48;"> docs_url</span><span style="color:#999999;">=</span><span style="color:#1E754F;">None</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A65E2B;">ORIGIN_URL</span><span style="color:#999999;"> =</span><span style="color:#B5695977;"> &quot;</span><span style="color:#B56959;">https://mobilelearn.chaoxing.com</span><span style="color:#B5695977;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">@</span><span style="color:#59873A;">app</span><span style="color:#999999;">.</span><span style="color:#59873A;">get</span><span style="color:#999999;">(</span><span style="color:#B5695977;">&quot;</span><span style="color:#B56959;">/</span><span style="color:#A65E2B;">{path</span><span style="color:#AB5959;">:</span><span style="color:#A65E2B;">path}</span><span style="color:#B5695977;">&quot;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#AB5959;">async</span><span style="color:#AB5959;"> def</span><span style="color:#59873A;"> proxy</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    request</span><span style="color:#999999;">:</span><span style="color:#393A34;"> Request</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">):</span></span>
<span class="line"><span style="color:#393A34;">    path </span><span style="color:#999999;">=</span><span style="color:#393A34;"> request</span><span style="color:#999999;">.</span><span style="color:#393A34;">url</span><span style="color:#999999;">.</span><span style="color:#393A34;">path</span><span style="color:#999999;">.</span><span style="color:#393A34;">replace</span><span style="color:#999999;">(</span><span style="color:#B5695977;">&quot;</span><span style="color:#B56959;">/proxy</span><span style="color:#B5695977;">&quot;</span><span style="color:#999999;">,</span><span style="color:#B5695977;"> &quot;&quot;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#A0ADA0;">    # 这里应该加入校验 path 和 cookies，防止恶意请求</span></span>
<span class="line"><span style="color:#1E754F;">    async</span><span style="color:#1E754F;"> with</span><span style="color:#393A34;"> httpx</span><span style="color:#999999;">.</span><span style="color:#393A34;">AsyncClient</span><span style="color:#999999;">(</span><span style="color:#B07D48;">http2</span><span style="color:#999999;">=</span><span style="color:#1E754F;">True</span><span style="color:#999999;">,</span><span style="color:#B07D48;"> timeout</span><span style="color:#999999;">=</span><span style="color:#2F798A;">10</span><span style="color:#999999;">)</span><span style="color:#1E754F;"> as</span><span style="color:#393A34;"> client</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">        resp </span><span style="color:#999999;">=</span><span style="color:#1E754F;"> await</span><span style="color:#393A34;"> client</span><span style="color:#999999;">.</span><span style="color:#393A34;">get</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#B07D48;">            url</span><span style="color:#999999;">=</span><span style="color:#393A34;">urljoin</span><span style="color:#999999;">(</span><span style="color:#A65E2B;">ORIGIN_URL</span><span style="color:#999999;">,</span><span style="color:#393A34;"> path</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#B07D48;">            params</span><span style="color:#999999;">=</span><span style="color:#393A34;">request</span><span style="color:#999999;">.</span><span style="color:#393A34;">query_params</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#B07D48;">            cookies</span><span style="color:#999999;">=</span><span style="color:#998418;">dict</span><span style="color:#999999;">(</span><span style="color:#393A34;">request</span><span style="color:#999999;">.</span><span style="color:#393A34;">cookies</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#999999;">        )</span></span>
<span class="line"><span style="color:#1E754F;">    return</span><span style="color:#393A34;"> Response</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#B07D48;">        content</span><span style="color:#999999;">=</span><span style="color:#393A34;">resp</span><span style="color:#999999;">.</span><span style="color:#393A34;">content</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#B07D48;">        status_code</span><span style="color:#999999;">=</span><span style="color:#393A34;">resp</span><span style="color:#999999;">.</span><span style="color:#393A34;">status_code</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,21)])])}const i=n(o,[["render",r]]),d=JSON.parse('{"path":"/advance/server.html","title":"反代服务器","lang":"zh-CN","frontmatter":{"title":"反代服务器","icon":"iconfont icon-study","category":["Advance"],"tag":["Advance"],"order":25,"description":"反向代理服务端部署教程 微信小程序配置服务器域名 要求域名已备案 自用无需备案，体验版开启调试模式即可 使用 CDN 或边缘函数反代 使用 Cloudflare Worker 把下面的反向代理脚本粘贴到 Workers 编辑器中。 注意：Worker默认的域名已被墙，请自备域名；已知部分沿海城市阻断了CF的IP。 使用 Cloudflare Worke...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"反代服务器\\",\\"image\\":[\\"https://deploy.workers.cloudflare.com/button\\",\\"https://cdnstatic.tencentcs.com/edgeone/pages/deploy.svg\\"],\\"dateModified\\":\\"2025-10-08T18:19:32.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Misaka\\",\\"url\\":\\"https://github.com/Misaka-1314\\"}]}"],["meta",{"property":"og:url","content":"https://doc.micono.eu.org/./advance/server.html"}],["meta",{"property":"og:site_name","content":"Misaka 文档"}],["meta",{"property":"og:title","content":"反代服务器"}],["meta",{"property":"og:description","content":"反向代理服务端部署教程 微信小程序配置服务器域名 要求域名已备案 自用无需备案，体验版开启调试模式即可 使用 CDN 或边缘函数反代 使用 Cloudflare Worker 把下面的反向代理脚本粘贴到 Workers 编辑器中。 注意：Worker默认的域名已被墙，请自备域名；已知部分沿海城市阻断了CF的IP。 使用 Cloudflare Worke..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://deploy.workers.cloudflare.com/button"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-10-08T18:19:32.000Z"}],["meta",{"property":"article:tag","content":"Advance"}],["meta",{"property":"article:modified_time","content":"2025-10-08T18:19:32.000Z"}]]},"git":{"createdTime":1759947572000,"updatedTime":1759947572000,"contributors":[{"name":"Misaka","username":"Misaka","email":"misaka@yangrucheng.top","commits":1,"url":"https://github.com/Misaka"}]},"readingTime":{"minutes":1.69,"words":506},"filePathRelative":"advance/server.md","autoDesc":true}');export{i as comp,d as data};
