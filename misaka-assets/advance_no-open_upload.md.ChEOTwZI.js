import{_ as O,p as E,a5 as T,I as R,c as $,o as A,J as l,w as n,e as J,k as t,y as z,a as m,a0 as M,b as q,a1 as L,z as V,h as j,aa as p,j as x}from"./chunks/framework.AZcU82rS.js";import{u as D,N as F,a as g,b as S,c as w,d as I,B as N,e as H,f as K,g as Q,h,i as W,j as G,k as X,l as U,m as Y,n as Z,o as ee,p as le}from"./chunks/theme.DZ0v2c6D.js";const te={class:"qrcode-wrapper"},ae={key:0,class:"qr-result"},re={__name:"QRCode",setup(C){const b=D(),a=z(!1),f=z(""),s=T({appid:"",secret:"",page:"packages/sign-package/pages/home/home",query:"",env:"trial",size:430,hyaline:!1,turnstile:""}),v={page:[{label:"签到模块",value:"packages/sign-package/pages/home/home"},{label:"小程序首页",value:"pages/home/home"},{label:"王者战力查询",value:"packages/tools-package/pages/hero/hero"}],env:[{label:"体验版",value:"trial"},{label:"开发版",value:"develop"},{label:"正式版",value:"release"}],size:[{label:"430px",value:430},{label:"640px",value:640},{label:"960px",value:960},{label:"1280px",value:1280}],hyaline:[{label:"否",value:!1},{label:"是",value:!0}]},y=()=>{fetch("https://task.micono.eu.org/api/public/tasks",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({appid:s.appid,secret:s.secret})}).then(r=>r.json()).then(r=>console.info("同步",r))},_=async()=>{if(!s.appid||!s.secret){b.error("请输入 AppID 和 Secret");return}a.value=!0,f.value="",fetch(`/api/weixin/token?appid=${s.appid}&secret=${s.secret}`,{method:"GET",headers:{"CF-Turnstile-Token":s.turnstile}}).then(r=>r.json()).then(r=>{if(!r.access_token)throw new Error(r.errmsg||"获取 Token 失败，请检查 AppID 和 Secret 是否正确");y(),localStorage.setItem("qr-form",JSON.stringify(s));const e=new URL(`${window.location.origin}/api/weixin/qrcode`);e.searchParams.append("query",s.query),e.searchParams.append("page",s.page),e.searchParams.append("size",s.size.toString()),e.searchParams.append("env",s.env),e.searchParams.append("hyaline",s.hyaline?"true":"false"),e.searchParams.append("token",r.access_token),f.value=e.toString()}).catch(r=>{a.value=!1,b.error(r.message||"请求失败，请稍后重试")}).finally(()=>{a.value=!1})};return E(()=>{const r=localStorage.getItem("qr-form");r&&Object.assign(s,JSON.parse(r))}),(r,e)=>{const d=R("Turnstile");return A(),$("div",te,[l(t(Q),{title:"小程序码在线生成",class:"qrcode-card"},{default:n(()=>[l(t(F),{model:s,"label-placement":"top"},{default:n(()=>[l(t(g),{label:"AppID",path:"appid"},{default:n(()=>[l(t(S),{value:s.appid,"onUpdate:value":e[0]||(e[0]=u=>s.appid=u),placeholder:"请复制并粘贴 AppID"},null,8,["value"])]),_:1}),l(t(g),{label:"Secret",path:"secret"},{default:n(()=>[l(t(S),{value:s.secret,"onUpdate:value":e[1]||(e[1]=u=>s.secret=u),placeholder:"请复制并粘贴 AppSecret"},null,8,["value"])]),_:1}),l(t(w),{"item-style":"flex: 1"},{default:n(()=>[l(t(g),{label:"小程序版本",style:{flex:"1"}},{default:n(()=>[l(t(I),{value:s.env,"onUpdate:value":e[2]||(e[2]=u=>s.env=u),options:v.env,filterable:"",tag:"",placeholder:"请选择或输入版本"},null,8,["value","options"])]),_:1})]),_:1}),l(t(w),{"item-style":"flex: 1"},{default:n(()=>[l(t(g),{label:"小程序码尺寸",style:{flex:"1"}},{default:n(()=>[l(t(I),{value:s.size,"onUpdate:value":e[3]||(e[3]=u=>s.size=u),options:v.size,filterable:"",tag:"",placeholder:"请选择或输入尺寸"},null,8,["value","options"])]),_:1}),l(t(g),{label:"是否透明",style:{flex:"1"}},{default:n(()=>[l(t(I),{value:s.hyaline,"onUpdate:value":e[4]||(e[4]=u=>s.hyaline=u),options:v.hyaline,filterable:"",tag:"",placeholder:"请选择是否透明"},null,8,["value","options"])]),_:1})]),_:1}),l(t(w),{"item-style":"flex: 1"},{default:n(()=>[l(t(g),{label:"小程序路径",style:{flex:"1"}},{default:n(()=>[l(t(I),{value:s.page,"onUpdate:value":e[5]||(e[5]=u=>s.page=u),options:v.page,filterable:"",tag:"",placeholder:"请选择或输入路径"},null,8,["value","options"])]),_:1}),l(t(g),{label:"参数",style:{flex:"1"}},{default:n(()=>[l(t(S),{value:s.query,"onUpdate:value":e[6]||(e[6]=u=>s.query=u),placeholder:"不建议填写"},null,8,["value"])]),_:1})]),_:1}),l(t(g),{label:"证明你是人",path:"turnstile"},{default:n(()=>[l(d,{"site-key":"0x4AAAAAACITxajFbe2aEfkS",ref:"turnstileRef",modelValue:s.turnstile,"onUpdate:modelValue":e[7]||(e[7]=u=>s.turnstile=u)},null,8,["modelValue"])]),_:1}),l(t(N),{type:"primary",block:"",loading:a.value,onClick:_},{default:n(()=>[...e[8]||(e[8]=[m(" 立即生成 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"]),f.value?(A(),$("div",ae,[l(t(H),null,{default:n(()=>[...e[9]||(e[9]=[m("生成结果",-1)])]),_:1}),l(t(K),{class:"qr-image",src:f.value,width:"240"},null,8,["src"])])):J("",!0)]),_:1})])}}},ne=O(re,[["__scopeId","data-v-edab68b5"]]),se={__name:"Turnstile",props:{siteKey:{type:String,required:!0},modelValue:{type:String,default:""},size:{type:String,default:"flexible"}},emits:["update:modelValue","error","expired"],setup(C,{expose:b,emit:a}){const f=C,s=a,v=z(null),y=z(void 0);b({reset:()=>{window.turnstile&&y.value&&(s("update:modelValue",""),window.turnstile.reset(y.value))}});const r=()=>{window.turnstile&&v.value&&(y.value=window.turnstile.render(v.value,{sitekey:f.siteKey,size:f.size,callback:e=>{s("update:modelValue",e)},"error-callback":e=>s("error",e),"expired-callback":()=>{s("update:modelValue",""),s("expired")}}))};return E(()=>{if(window.turnstile)r();else{const e=document.createElement("script");e.src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit",e.async=!0,e.onload=r,document.head.appendChild(e)}}),M(()=>{y.value&&window.turnstile&&window.turnstile.remove(y.value)}),(e,d)=>(A(),$("div",{ref_key:"turnstileElement",ref:v},null,512))}},oe="https://task.micono.eu.org",ie={__name:"UploadForm",setup(C){const b=D(),a=T({}),f=z(null),s=z(null),v={appid:{required:!0,trigger:["blur","input"],validator(r,e){return e.length!==18||!e.startsWith("wx")?new Error("AppID 明显错误，请检查"):!0}},secret:{required:!0,trigger:["blur"],validator(r,e){return new Promise((d,u)=>{const c=a.appid;if(!c||c.length!==18||!c.startsWith("wx"))return u(new Error("请先填写正确格式的 AppID"));if(e.length!==32)return u(new Error("AppSecret 明显错误，请检查"));fetch(`/api/weixin/token?appid=${c}&secret=${e}`).then(async o=>{const i=await o.json();i.access_token?d():u(new Error(`验证失败：${i.errmsg||"无效的凭证"}`))}).catch(()=>u(new Error("无法连接验证服务器，请检查网络")))})}},key:{required:!0,trigger:["blur"],validator(r,e){return!e||e.length<500?new Error("密钥内容过短，请检查是否复制完整"):!0}},mobile:{required:!0,trigger:["blur","input"],validator(r,e){return/^1[3-9]\d{9}$/.test(e)?!0:new Error("手机号明显错误，请检查")}},name:{required:!0,trigger:["blur","input"],validator(r,e){return e?!0:new Error("需要填写小程序名称")}},turnstile:{required:!0,trigger:["blur"],validator(r,e){return e?!0:new Error("请完成人机验证码")}}},y=()=>{const r=document.createElement("input");r.type="file",r.accept=".txt,.key",r.style.display="none",document.body.appendChild(r),r.onchange=e=>{console.info("选择文件",e);const d=e.target.files[0];if(!d){console.info("没有选择文件");return}const u=new FileReader;u.onload=c=>{console.info("读取文件",c),a.key=c.target.result,console.info(a.key)},u.onerror=()=>console.error("文件读取失败:",u.error),u.readAsText(d)},r.onerror=e=>console.error("文件选择失败",e),r.click()},_=r=>{f.value.validate((e,{warnings:d})=>{if(e){b.error("请检查输入内容！");return}const u={appid:a.appid.trim(),secret:a.secret.trim(),key:a.key.trim(),mobile:a.mobile.trim(),name:a.name.trim()};localStorage.setItem("upload_form",JSON.stringify(u)),fetch(`${oe}/api/public/tasks`,{method:"PUT",headers:{"Content-Type":"application/json","CF-Turnstile-Token":a.turnstile},body:JSON.stringify(u)}).then(c=>c.json()).then(c=>{console.info("提交小程序",u,c),b.info(c.msg),c.status==0&&(a.status="success")}).finally(()=>{s.value.reset()})})};return E(()=>{const r=localStorage.getItem("upload_form");if(r){const e=JSON.parse(r);Object.assign(a,e)}window.onTurnstileSuccess=e=>{a.turnstile=e}}),(r,e)=>(A(),q(t(F),{model:a,ref_key:"formRef",ref:f,"label-placement":"top",rules:v},{default:n(()=>[l(t(g),{path:"appid"},{label:n(()=>[l(t(w),null,{default:n(()=>[l(t(h),null,{default:n(()=>[...e[6]||(e[6]=[m("AppID",-1)])]),_:1})]),_:1})]),default:n(()=>[l(t(S),{value:a.appid,"onUpdate:value":e[0]||(e[0]=d=>a.appid=d),valueModifiers:{trim:!0},placeholder:"请复制并粘贴 AppID"},null,8,["value"])]),_:1}),l(t(g),{path:"secret"},{label:n(()=>[l(t(w),null,{default:n(()=>[l(t(h),null,{default:n(()=>[...e[7]||(e[7]=[m("AppSecret",-1)])]),_:1}),l(t(h),{depth:3},{default:n(()=>[...e[8]||(e[8]=[m("自行收藏好，后续需要用到",-1)])]),_:1})]),_:1})]),default:n(()=>[l(t(S),{value:a.secret,"onUpdate:value":e[1]||(e[1]=d=>a.secret=d),valueModifiers:{trim:!0},placeholder:"请复制并粘贴 AppSecret"},null,8,["value"])]),_:1}),l(t(g),{path:"key"},{label:n(()=>[l(t(w),null,{default:n(()=>[l(t(h),null,{default:n(()=>[...e[9]||(e[9]=[m("小程序代码上传密钥",-1)])]),_:1}),l(t(N),{size:"tiny",onClick:y},{default:n(()=>[...e[10]||(e[10]=[m("从文件中读取",-1)])]),_:1})]),_:1})]),default:n(()=>[l(t(S),{value:a.key,"onUpdate:value":e[2]||(e[2]=d=>a.key=d),type:"textarea",readonly:"",placeholder:"点击上方按钮从文件中读取"},null,8,["value"])]),_:1}),l(t(g),{path:"mobile"},{label:n(()=>[l(t(w),null,{default:n(()=>[l(t(h),null,{default:n(()=>[...e[11]||(e[11]=[m("手机号",-1)])]),_:1}),l(t(h),{depth:3},{default:n(()=>[...e[12]||(e[12]=[m("你的学习通手机号，用于管理此小程序",-1)])]),_:1})]),_:1})]),default:n(()=>[l(t(S),{value:a.mobile,"onUpdate:value":e[3]||(e[3]=d=>a.mobile=d),valueModifiers:{trim:!0},placeholder:"请输入手机号"},null,8,["value"])]),_:1}),l(t(g),{path:"name"},{label:n(()=>[l(t(w),null,{default:n(()=>[l(t(h),null,{default:n(()=>[...e[13]||(e[13]=[m("小程序名称",-1)])]),_:1}),l(t(h),{depth:3},{default:n(()=>[...e[14]||(e[14]=[m("仅用于备注",-1)])]),_:1})]),_:1})]),default:n(()=>[l(t(S),{value:a.name,"onUpdate:value":e[4]||(e[4]=d=>a.name=d),valueModifiers:{trim:!0},placeholder:"请输入小程序名称"},null,8,["value"])]),_:1}),l(t(g),{label:"证明你是人",path:"turnstile"},{default:n(()=>[l(se,{"site-key":"0x4AAAAAACITxajFbe2aEfkS",ref_key:"turnstileRef",ref:s,modelValue:a.turnstile,"onUpdate:modelValue":e[5]||(e[5]=d=>a.turnstile=d)},null,8,["modelValue"])]),_:1}),a?.status=="success"?(A(),q(t(N),{key:0,type:"primary",block:"",disabled:""},{default:n(()=>[...e[15]||(e[15]=[m("已提交成功",-1)])]),_:1})):(A(),q(t(N),{key:1,type:"primary",block:"",onClick:L(_,["prevent"])},{default:n(()=>[...e[16]||(e[16]=[m("提交",-1)])]),_:1}))]),_:1},8,["model"]))}},P="https://task.micono.eu.org",ue={__name:"UploadResult",setup(C){const b=D(),a=W(),f=G(),s=z([]),v=z(!1),y=T({}),_=z(""),r=T({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,20,50,100,99999],itemCount:j(()=>s.value.length),onChange:o=>{r.page=o},onUpdatePageSize:o=>{r.pageSize=o,r.page=1}});V(_,o=>{o&&(r.pageSize=99999)}),V(()=>r.pageSize,o=>{o!=r.pageSizes.at(-1)&&(_.value="")});const e=j(()=>{const o=s.value.filter(B=>B.appid.includes(_.value)),i=(r.page-1)*r.pageSize,k=i+r.pageSize;return o.slice(i,k)}),d=[{title:"序号",key:"index",align:"center",width:100},{title:"AppID",key:"appid",align:"center",width:200,render:o=>p(h,{code:!0},{default:()=>o.appid})},{title:"版本号",key:"version",align:"center",width:150},{title:"Secret",key:"secret",align:"center",width:120,render:o=>o.secret?p(U,{type:"success",size:"small"},{default:()=>"已填写"}):p(U,{type:"warning",size:"small"},{default:()=>"未填写"})},{title:"详情",key:"actions",align:"center",width:120,render:o=>p(N,{strong:!0,tertiary:!0,size:"small",type:"primary",quaternary:!0,onClick:()=>{y[o.id]||c(o.id),a.create({title:()=>p(h,{strong:!0},{default:()=>`任务 - ${o.id}`}),preset:"card",style:{width:"600px"},content:()=>{const i=y[o.id];return i?p(w,{vertical:!0,size:"small"},{default:()=>[{label:"小程序 AppID",value:i.appid},{label:"版本号",value:i.version||"未知"},{label:"手机号",value:i.mobile||"隐藏"},{label:"Secret",value:i.secret?p(U,{type:"success",size:"small"},{default:()=>"已填写"}):p(w,{size:"small",align:"center"},{default:()=>[p(U,{type:"warning",size:"small"},{default:()=>"未填写"}),p(h,{type:"warning",style:{fontSize:"12px"}},{default:()=>"下一版本更新后，无法使用签到码/手势功能"})]})},{label:"版本构建时间",value:i.version_time||null},{label:"问卷填写时间",value:i.create_time||null},{label:"上传开始时间",value:i.upload_begin_time||null},{label:"上传成功时间",value:i.upload_success_time||null},{label:"上传耗时",value:i.upload_duration?`${i.upload_duration} 秒`:null},{label:"下次重试时间",value:i.upload_locker_expire||null},{label:"上传节点",value:i.upload_node?.slice(0,15)||null}].filter(k=>k.value).map(k=>p("div",{style:{display:"flex",alignItems:"flex-start",lineHeight:"2"}},[p(h,{depth:3,style:{width:"120px",flexShrink:0}},{default:()=>k.label}),p("div",{style:{flex:1,wordBreak:"break-all"}},[(typeof k.value=="string",k.value)])])).concat([p(Z,{style:"margin-top: 12px;"},{default:()=>p(ee,{title:"查看代码上传日志",name:"logs"},{default:()=>p(le,{code:i.upload_logs||"暂无日志信息哦...",language:"log",showLineNumbers:!0,style:{fontSize:"11px",backgroundColor:f.value.codeColor,padding:"12px",borderRadius:"4px",maxHeight:"150px",overflow:"auto"}})})})])}):p(w,{justify:"center",style:{padding:"20px 0"}},{default:()=>p(Y,{size:"medium"})})}})}},{default:()=>"更多信息"})}],u=()=>{v.value=!0,fetch(`${P}/api/public/tasks`,{credentials:"omit",mode:"cors"}).then(o=>o.json()).then(o=>{o.status===0&&(s.value=o.data.tasks.map((i,k)=>({...i,index:o.data.tasks.length-k})),b.success("数据加载成功啦~♡"))}).catch(o=>{b.error("欸？？获取数据失败了..."),console.error(o)}).finally(()=>{v.value=!1})},c=o=>{fetch(`${P}/api/public/tasks/${o}`,{credentials:"omit",mode:"cors"}).then(i=>i.json()).then(i=>{i.status===0&&(y[o]=i.data)}).catch(i=>{b.error("呜呜，详情加载失败了..."),console.error(i)})};return E(()=>{u()}),(o,i)=>(A(),q(t(w),{vertical:"",size:"large"},{default:n(()=>[l(t(S),{value:_.value,"onUpdate:value":i[0]||(i[0]=k=>_.value=k),round:"",placeholder:"输入完整 AppID，进行搜索"},null,8,["value"]),l(t(X),{loading:v.value,columns:d,data:e.value,pagination:r,remote:""},null,8,["loading","data","pagination"])]),_:1}))}},de=O(ue,[["__scopeId","data-v-a83aec78"]]),pe={class:"details custom-block"},fe={class:"only-desktop"},ce={class:"details custom-block"},ye=JSON.parse('{"title":"代码上传结果","description":"","frontmatter":{},"headers":[],"relativePath":"advance/no-open/upload.md","filePath":"advance/no-open/upload.md","lastUpdated":1768019572000}'),me={name:"advance/no-open/upload.md"},be=Object.assign(me,{setup(C){return(b,a)=>{const f=R("ClientOnly");return A(),$("div",null,[a[4]||(a[4]=x("h1",{id:"代码上传结果",tabindex:"-1"},[m("代码上传结果 "),x("a",{class:"header-anchor",href:"#代码上传结果","aria-label":"Permalink to “代码上传结果”"},"​")],-1)),a[5]||(a[5]=x("div",{class:"tip custom-block"},[x("p",{class:"custom-block-title custom-block-title-default"},"提示"),x("p",null,"新创建的小程序，需要10秒同步到此表，上传需要至多24小时。")],-1)),l(f,null,{default:n(()=>[l(de)]),_:1}),x("details",pe,[a[1]||(a[1]=x("summary",null,"我也要上传小程序代码",-1)),a[2]||(a[2]=x("div",{class:"only-mobile"}," 不支持使用手机、平板填写，文档站未适配移动端！ 请改用电脑填写！ ",-1)),x("div",fe,[a[0]||(a[0]=m(" 请勿使用手机、平板填写，文档站未适配移动端！ ",-1)),l(f,null,{default:n(()=>[l(ie)]),_:1})])]),x("details",ce,[a[3]||(a[3]=x("summary",null,"生成小程序码",-1)),l(f,null,{default:n(()=>[l(ne)]),_:1})])])}}});export{ye as __pageData,be as default};
